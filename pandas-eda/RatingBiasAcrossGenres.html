<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>RatingBiasAcrossGenres</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="RatingBiasAcrossGenres_files/libs/clipboard/clipboard.min.js"></script>
<script src="RatingBiasAcrossGenres_files/libs/quarto-html/quarto.js"></script>
<script src="RatingBiasAcrossGenres_files/libs/quarto-html/popper.min.js"></script>
<script src="RatingBiasAcrossGenres_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="RatingBiasAcrossGenres_files/libs/quarto-html/anchor.min.js"></script>
<link href="RatingBiasAcrossGenres_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="RatingBiasAcrossGenres_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="RatingBiasAcrossGenres_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="RatingBiasAcrossGenres_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="RatingBiasAcrossGenres_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">RatingBiasAcrossGenres</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This notebook explores potential biases in how books from different genres are rated on Goodreads. By examining the ratings of top-ranked novels across genres, we aim to identify whether certain genres consistently receive higher or lower ratings than others, and what factors may influence these trends.</p>
<section id="import-libraries-and-read-data" class="level3">
<h3 class="anchored" data-anchor-id="import-libraries-and-read-data">1. Import Libraries and Read Data</h3>
<p>This step involves importing the necessary Python libraries that will be used throughout the analysis, such as pandas for data manipulation, seaborn and matplotlib for visualization, and altair for interactive charts. After importing the libraries, we load the dataset from the provided URL.</p>
<div id="cell-3" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/melaniewalsh/responsible-datasets-in-context/main/datasets/top-500-novels/library_top_500.csv"</span>, sep<span class="op">=</span><span class="st">','</span>, header<span class="op">=</span><span class="dv">0</span>, low_memory<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exploratory-data-analysis-eda" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-data-analysis-eda">2. Exploratory Data Analysis (EDA)</h3>
<p>EDA is an essential first step in any data analysis process. Here, we aim to understand the structure of the dataset and explore the relationships between variables such as genre and gr_avg_rating.</p>
<p>Summary Statistics This part of the analysis will give you a quick overview of the numeric columns in the dataset, such as the mean, median, standard deviation, and range of values for the ratings.</p>
<div id="cell-5" class="cell" data-outputid="cab8bb0c-bc39-4021-e116-769d7fc39d8d" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df.describe().T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">

  <div id="df-9882a038-3a8c-496c-90c9-ce6b1ba5394d" class="colab-df-container">
    <div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">top_500_rank</td>
<td>500.0</td>
<td>2.505000e+02</td>
<td>1.444818e+02</td>
<td>1.00</td>
<td>125.75</td>
<td>250.50</td>
<td>3.752500e+02</td>
<td>5.000000e+02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">pub_year</td>
<td>500.0</td>
<td>1.932132e+03</td>
<td>8.430655e+01</td>
<td>1021.00</td>
<td>1900.00</td>
<td>1948.00</td>
<td>1.989000e+03</td>
<td>2.015000e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">oclc_holdings</td>
<td>495.0</td>
<td>1.040144e+04</td>
<td>5.694509e+03</td>
<td>996.00</td>
<td>6800.00</td>
<td>8318.00</td>
<td>1.218400e+04</td>
<td>3.770200e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">oclc_eholdings</td>
<td>495.0</td>
<td>2.218594e+03</td>
<td>3.084596e+03</td>
<td>25.00</td>
<td>352.00</td>
<td>558.00</td>
<td>3.223000e+03</td>
<td>1.554500e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">oclc_total_editions</td>
<td>495.0</td>
<td>8.966424e+02</td>
<td>1.019016e+03</td>
<td>21.00</td>
<td>241.00</td>
<td>485.00</td>
<td>1.207500e+03</td>
<td>9.017000e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">oclc_holdings_rank</td>
<td>495.0</td>
<td>2.480000e+02</td>
<td>1.430385e+02</td>
<td>1.00</td>
<td>124.50</td>
<td>248.00</td>
<td>3.715000e+02</td>
<td>4.950000e+02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">oclc_editions_rank</td>
<td>495.0</td>
<td>2.480000e+02</td>
<td>1.430385e+02</td>
<td>1.00</td>
<td>124.50</td>
<td>248.00</td>
<td>3.715000e+02</td>
<td>4.950000e+02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">gr_avg_rating</td>
<td>500.0</td>
<td>3.971440e+00</td>
<td>2.276875e-01</td>
<td>3.29</td>
<td>3.83</td>
<td>3.98</td>
<td>4.120000e+00</td>
<td>4.620000e+00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">gr_avg_rating_rank</td>
<td>500.0</td>
<td>2.505000e+02</td>
<td>1.444818e+02</td>
<td>1.00</td>
<td>125.75</td>
<td>250.50</td>
<td>3.752500e+02</td>
<td>5.000000e+02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">gr_num_ratings_rank</td>
<td>500.0</td>
<td>2.505000e+02</td>
<td>1.444818e+02</td>
<td>1.00</td>
<td>125.75</td>
<td>250.50</td>
<td>3.752500e+02</td>
<td>5.000000e+02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">oclc_owi</td>
<td>495.0</td>
<td>1.602208e+09</td>
<td>2.675299e+09</td>
<td>1040.00</td>
<td>397287.50</td>
<td>16756029.00</td>
<td>2.830459e+09</td>
<td>1.239276e+10</td>
</tr>
</tbody>
</table>

</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-9882a038-3a8c-496c-90c9-ce6b1ba5394d')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-9882a038-3a8c-496c-90c9-ce6b1ba5394d button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-9882a038-3a8c-496c-90c9-ce6b1ba5394d');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-c474396f-271e-49a8-874b-652aa3ca09e2">
  <button class="colab-df-quickchart" onclick="quickchart('df-c474396f-271e-49a8-874b-652aa3ca09e2')" title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-c474396f-271e-49a8-874b-652aa3ca09e2 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>
</div>
</div>
<section id="data-types-and-unique-value-counts" class="level4">
<h4 class="anchored" data-anchor-id="data-types-and-unique-value-counts">Data Types and Unique Value Counts</h4>
<p>Next, we check the data types of the columns and the unique values for genre and gr_avg_rating. This step ensures the data is in the correct format for analysis and helps us identify categorical variables.</p>
<div id="cell-7" class="cell" data-outputid="ce9ecaf1-3cd7-490b-b52a-6eadbffee3ff" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">top_500_rank</td>
<td>int64</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">title</td>
<td>object</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">author</td>
<td>object</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">pub_year</td>
<td>int64</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">orig_lang</td>
<td>object</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">genre</td>
<td>object</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">author_birth</td>
<td>object</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">author_death</td>
<td>object</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">author_gender</td>
<td>object</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">author_primary_lang</td>
<td>object</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">author_nationality</td>
<td>object</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">author_field_of_activity</td>
<td>object</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">author_occupation</td>
<td>object</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">oclc_holdings</td>
<td>float64</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">oclc_eholdings</td>
<td>float64</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">oclc_total_editions</td>
<td>float64</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">oclc_holdings_rank</td>
<td>float64</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">oclc_editions_rank</td>
<td>float64</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">gr_avg_rating</td>
<td>float64</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">gr_num_ratings</td>
<td>object</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">gr_num_reviews</td>
<td>object</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">gr_avg_rating_rank</td>
<td>int64</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">gr_num_ratings_rank</td>
<td>int64</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">oclc_owi</td>
<td>float64</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">author_viaf</td>
<td>object</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">gr_url</td>
<td>object</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">wiki_url</td>
<td>object</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">pg_eng_url</td>
<td>object</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">pg_orig_url</td>
<td>object</td>
</tr>
</tbody>
</table>

</div><br><label><b>dtype:</b> object</label>
</div>
</div>
<div id="cell-8" class="cell" data-outputid="e7302653-191d-4403-d7ca-c9bce1da1629" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>genre_counts <span class="op">=</span> df[<span class="st">"genre"</span>].value_counts()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(genre_counts)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>rating_counts <span class="op">=</span> df[<span class="st">"gr_avg_rating"</span>].value_counts()</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rating_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>genre
na            221
history        53
fantasy        48
romance        33
bildung        27
scifi          21
thrillers      21
mystery        18
action         16
political      15
horror          8
autobio         8
allegories      7
war             4
Name: count, dtype: int64
gr_avg_rating
3.99    13
4.09    13
3.94    13
3.96    13
4.02    13
        ..
3.45     1
4.30     1
4.32     1
4.56     1
3.31     1
Name: count, Length: 106, dtype: int64</code></pre>
</div>
</div>
</section>
</section>
<section id="average-rating-across-genres" class="level3">
<h3 class="anchored" data-anchor-id="average-rating-across-genres">3. Average Rating Across Genres</h3>
<p>This part of the analysis calculates the average rating for each genre. By grouping the dataset by genre and calculating the mean gr_avg_rating for each group, we can identify which genres tend to have higher or lower ratings.</p>
<div id="cell-10" class="cell" data-outputid="3dfae2c3-4c13-4baa-a015-b8ef399a1184" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>avg_rating_by_genre <span class="op">=</span> df.groupby(<span class="st">'genre'</span>)[<span class="st">'gr_avg_rating'</span>].mean().reset_index()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>avg_rating_by_genre.sort_values(<span class="st">'gr_avg_rating'</span>, ascending<span class="op">=</span><span class="va">False</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(avg_rating_by_genre)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         genre  gr_avg_rating
4      fantasy       4.141250
6       horror       4.066250
2      autobio       4.062500
11       scifi       4.054286
7      mystery       4.022778
10     romance       3.989091
13         war       3.965000
5      history       3.964340
12   thrillers       3.944286
8           na       3.939186
9    political       3.934667
1   allegories       3.925714
3      bildung       3.909630
0       action       3.831250</code></pre>
</div>
</div>
</section>
<section id="visualizing-rating-bias" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-rating-bias">4. Visualizing Rating Bias</h3>
<p>After calculating the average rating for each genre, we can visualize the data to better understand any biases. We use plots to compare average ratings across genres.</p>
<section id="bar-plot-using-seaborn" class="level4">
<h4 class="anchored" data-anchor-id="bar-plot-using-seaborn">Bar Plot (using Seaborn)</h4>
<p>A bar plot is created to visualize the average rating of each genre, where the genre names are plotted on the y-axis and the average rating is plotted on the x-axis.</p>
<div id="cell-12" class="cell" data-outputid="2b6e1346-4440-432d-92f2-0673e4902c90" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">'gr_avg_rating'</span>, y<span class="op">=</span><span class="st">'genre'</span>, data<span class="op">=</span>avg_rating_by_genre, palette<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Average Rating Across Genres"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Average Rating"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Genre"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>FutureWarning: 

Passing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.

  sns.barplot(x='gr_avg_rating', y='genre', data=avg_rating_by_genre, palette='viridis')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="RatingBiasAcrossGenres_files/figure-html/cell-7-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This bar plot shows the comparison of average ratings across different genres.</p>
<p>The height of each bar represents the average rating for that genre.</p>
<p>The viridis palette provides a visually appealing color scheme for the plot.</p>
</section>
<section id="violin-plot-for-distribution-of-ratings-by-genre" class="level4">
<h4 class="anchored" data-anchor-id="violin-plot-for-distribution-of-ratings-by-genre">Violin Plot (for distribution of ratings by genre)</h4>
<p>A violin plot shows the distribution of ratings within each genre, helping us identify if there is more variation in ratings for certain genres.</p>
<div id="cell-15" class="cell" data-outputid="767139a8-4dd9-4bb8-bf0c-68ec5fdf5592" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>sns.violinplot(x<span class="op">=</span><span class="st">'gr_avg_rating'</span>, y<span class="op">=</span><span class="st">'genre'</span>, data<span class="op">=</span>df, palette<span class="op">=</span><span class="st">'coolwarm'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Rating Distribution Across Genres"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Average Rating"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Genre"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>FutureWarning: 

Passing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.

  sns.violinplot(x='gr_avg_rating', y='genre', data=df, palette='coolwarm')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="RatingBiasAcrossGenres_files/figure-html/cell-8-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>A violin plot combines aspects of a box plot and a density plot. It shows the distribution of ratings for each genre and helps identify if some genres have higher variability in ratings.</p>
<p>The width of the “violin” at different rating values shows the density of ratings for each genre, helping us identify potential bias.</p>
</section>
<section id="correlation-between-number-of-ratings-and-average-rating" class="level4">
<h4 class="anchored" data-anchor-id="correlation-between-number-of-ratings-and-average-rating">5. Correlation Between Number of Ratings and Average Rating</h4>
<p>In this part of the analysis, we explore the relationship between the number of ratings (gr_num_ratings) and the average rating (gr_avg_rating). This helps us understand if the number of ratings for a genre might influence its average rating.</p>
<div id="cell-18" class="cell" data-outputid="a65d10af-b20d-4517-cf00-ac77c7e053b6" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'gr_num_ratings'</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">'gr_num_ratings'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span><span class="st">'gr_num_ratings'</span>, y<span class="op">=</span><span class="st">'gr_avg_rating'</span>, data<span class="op">=</span>df, hue<span class="op">=</span><span class="st">'genre'</span>, palette<span class="op">=</span><span class="st">'Set2'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Scatterplot: Number of Ratings vs. Average Rating"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Number of Ratings"</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Average Rating"</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="RatingBiasAcrossGenres_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="rating-bias-across-languages" class="level4">
<h4 class="anchored" data-anchor-id="rating-bias-across-languages">6. Rating Bias Across Languages</h4>
<p>This section explores the potential rating bias based on the language of the book (e.g., English, French, Spanish). We calculate the average rating for each language and visualize the results.</p>
<div id="cell-20" class="cell" data-outputid="c24ae176-f636-4225-a26b-d261c94c510b" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>avg_rating_by_lang <span class="op">=</span> df.groupby(<span class="st">'orig_lang'</span>)[<span class="st">'gr_avg_rating'</span>].mean().reset_index()</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>avg_rating_by_lang.sort_values(<span class="st">'gr_avg_rating'</span>, ascending<span class="op">=</span><span class="va">False</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">'gr_avg_rating'</span>, y<span class="op">=</span><span class="st">'orig_lang'</span>, data<span class="op">=</span>avg_rating_by_lang, palette<span class="op">=</span><span class="st">'coolwarm'</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Average Rating by Language"</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Average Rating"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Language"</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>FutureWarning: 

Passing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.

  sns.barplot(x='gr_avg_rating', y='orig_lang', data=avg_rating_by_lang, palette='coolwarm')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="RatingBiasAcrossGenres_files/figure-html/cell-10-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The average rating is grouped by the original language (orig_lang) of the books.</p>
<p>This analysis helps determine whether certain languages tend to have higher or lower average ratings.</p>
</section>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">Conclusion:</h3>
<p>The analysis of rating biases across genres on Goodreads reveals notable variations in how different genres are rated. Our findings suggest that genres like Fantasy often receive higher and more consistent ratings, while others, such as Biography or Historical Fiction, tend to have more variability or lower ratings. This trend is also influenced by the number of ratings a book has accumulated: books with more ratings tend to have more stable and reliable average ratings, whereas those with fewer ratings are more vulnerable to extreme biases.</p>
<p>Furthermore, the language of the book significantly impacts its average rating. Books originally published in certain languages, such as English, generally receive higher ratings compared to those in other languages. This may reflect language-related biases or the influence of a larger and more active readership in English-speaking regions.</p>
<p>The publication year also plays a role in rating patterns, with newer books generally receiving higher average ratings than older ones. This could be attributed to shifts in reader preferences, the more vocal and engaged audience of contemporary readers, or the increased visibility of newer books through platforms like Goodreads.</p>
<p>In conclusion, the analysis highlights how factors such as genre, the number of ratings, language, and publication year contribute to potential biases in book ratings. When interpreting book reviews and ratings, it is essential to consider these variables to gain a more balanced and comprehensive understanding of a book’s reception.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>